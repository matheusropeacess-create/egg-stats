<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#080a0c">
<title>Egg Stats ‚Äî Meu Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg:     #07090b;
  --bg2:    #0c1018;
  --bg3:    #101620;
  --surf:   #121b27;
  --surf2:  #18253a;
  --border: #1c2d42;
  --bord2:  #223348;
  --green:  #00e87a;
  --green2: #00ff88;
  --gdim:   #00b860;
  --glow:   rgba(0,232,122,.14);
  --glow2:  rgba(0,232,122,.06);
  --red:    #ff3d5a;
  --yellow: #f5c032;
  --blue:   #3d8bff;
  --text:   #dde8f5;
  --text2:  #6e90b0;
  --text3:  #384f65;
  --mono:   'Space Mono', monospace;
  --sans:   'DM Sans', sans-serif;
  --display:'Syne', sans-serif;
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box }
html { scroll-behavior:smooth }
body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--sans);
  min-height: 100vh;
  overflow-x: hidden;
}
/* scanline */
body::before {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:9000;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,.018) 2px, rgba(0,0,0,.018) 4px);
}
/* subtle grid bg */
body::after {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
  background-image:
    linear-gradient(rgba(0,232,122,.025) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,232,122,.025) 1px, transparent 1px);
  background-size: 48px 48px;
  mask-image: radial-gradient(ellipse 80% 60% at 50% 0%, black 30%, transparent 100%);
}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
.nav {
  position: sticky; top:0; z-index: 500;
  height: 60px;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 28px;
  background: rgba(7,9,11,.9);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
}
.nav-logo {
  display: flex; align-items: center; gap: 10px;
  font-family: var(--display); font-size: 17px; font-weight: 800;
  color: var(--text); text-decoration: none; letter-spacing: -.01em;
}
.egg {
  width: 28px; height: 28px;
  background: var(--green);
  border-radius: 50% 50% 50% 50% / 58% 58% 42% 42%;
  box-shadow: 0 0 16px var(--green), 0 0 40px rgba(0,232,122,.2);
  flex-shrink: 0; position: relative;
}
.egg::after {
  content:''; position:absolute; top:4px; left:5px;
  width:6px; height:5px;
  background: rgba(255,255,255,.35);
  border-radius: 50%;
  transform: rotate(-30deg);
}
.nav-logo span { color: var(--green); }
.nav-tabs { display: flex; gap: 2px; }
.ntab {
  padding: 6px 14px; border-radius: 6px;
  font-family: var(--mono); font-size: 11px; letter-spacing: .05em;
  color: var(--text3); background: transparent; border: none;
  cursor: pointer; transition: all .15s; position: relative;
}
.ntab:hover { color: var(--text2); background: var(--surf); }
.ntab.active { color: var(--green); background: var(--glow2); }
.ntab.active::after {
  content:''; position:absolute; bottom:0; left:50%; transform:translateX(-50%);
  width:16px; height:2px; background:var(--green);
  border-radius:2px; box-shadow: 0 0 8px var(--green);
}
.nav-right { display:flex; align-items:center; gap:14px; }
.pulse-badge {
  display:flex; align-items:center; gap:6px;
  font-family:var(--mono); font-size:10px; color:var(--text3); letter-spacing:.08em;
}
.pdot {
  width:7px; height:7px; border-radius:50%;
  background:var(--text3); transition:all .3s;
}
.pdot.live { background:var(--green); box-shadow:0 0 8px var(--green); animation:pulse 2s infinite; }
.pdot.err  { background:var(--red); }
.pdot.loading { background:var(--yellow); animation:pulse 1s infinite; }
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.4;transform:scale(.75)} }
.nav-clock { font-family:var(--mono); font-size:11px; color:var(--text3); }

/* ‚îÄ‚îÄ PLAN BADGE ‚îÄ‚îÄ */
.plan-pill {
  padding: 3px 10px; border-radius: 100px;
  font-family: var(--mono); font-size: 10px; font-weight: 700;
  letter-spacing: .08em; cursor: pointer;
  transition: all .2s;
}
.plan-free  { background:var(--surf2); color:var(--text3); border:1px solid var(--border); }
.plan-pro   { background:rgba(0,232,122,.12); color:var(--green); border:1px solid rgba(0,232,122,.3); }
.plan-elite { background:rgba(245,192,50,.12); color:var(--yellow); border:1px solid rgba(245,192,50,.3); box-shadow:0 0 12px rgba(245,192,50,.1); }

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.layout { display:grid; grid-template-columns:220px 1fr; min-height:calc(100vh - 60px); position:relative; z-index:1; }

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar {
  background: var(--bg2);
  border-right: 1px solid var(--border);
  padding: 24px 0;
  position: sticky; top:60px;
  height: calc(100vh - 60px);
  overflow-y: auto; overflow-x: hidden;
  display: flex; flex-direction: column;
}
.sb-section { padding: 0 14px; margin-bottom: 24px; }
.sb-label {
  font-family: var(--mono); font-size: 9px; letter-spacing: .15em;
  color: var(--text3); text-transform: uppercase;
  padding: 0 10px; margin-bottom: 10px;
}
.sb-nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 9px 12px; border-radius: 7px;
  font-size: 13px; color: var(--text2);
  cursor: pointer; border: none; background: transparent;
  width: 100%; text-align: left; transition: all .15s;
  margin-bottom: 2px;
}
.sb-nav-item:hover { background:var(--surf); color:var(--text); }
.sb-nav-item.active { background:var(--surf); color:var(--green); }
.sb-icon { font-size: 15px; width: 20px; text-align: center; flex-shrink: 0; }

.sb-bankroll {
  margin: 0 14px; padding: 16px;
  background: linear-gradient(135deg, var(--surf) 0%, rgba(0,232,122,.06) 100%);
  border: 1px solid rgba(0,232,122,.2);
  border-radius: 10px; position: relative; overflow: hidden;
}
.sb-bankroll::before {
  content:''; position:absolute; top:-20px; right:-20px;
  width:80px; height:80px;
  background: radial-gradient(circle, rgba(0,232,122,.15) 0%, transparent 70%);
}
.sb-br-label { font-family:var(--mono); font-size:9px; color:var(--text3); letter-spacing:.1em; text-transform:uppercase; margin-bottom:6px; }
.sb-br-val { font-family:var(--display); font-size:26px; font-weight:800; color:var(--green); text-shadow:0 0 20px rgba(0,232,122,.3); line-height:1; }
.sb-br-sub { font-size:11px; color:var(--text2); margin-top:4px; }
.sb-br-change { font-family:var(--mono); font-size:11px; margin-top:8px; }

.sb-stats { margin: 12px 14px 0; display:flex; flex-direction:column; gap:6px; }
.sb-stat {
  display:flex; justify-content:space-between; align-items:center;
  padding:8px 12px; background:var(--surf); border-radius:6px;
  border: 1px solid var(--border);
}
.sb-stat-label { font-size:12px; color:var(--text2); }
.sb-stat-val { font-family:var(--mono); font-size:12px; font-weight:700; }

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main { padding: 28px 32px; overflow-x: hidden; }
.page { display:none; }
.page.active { display:block; animation: pageIn .3s ease; }
@keyframes pageIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

/* ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ */
.ph {
  display:flex; align-items:flex-end; justify-content:space-between;
  margin-bottom: 28px; padding-bottom: 20px;
  border-bottom: 1px solid var(--border);
}
.ph-eyebrow {
  font-family: var(--mono); font-size: 10px; letter-spacing: .15em;
  color: var(--green); text-transform: uppercase; margin-bottom: 6px;
}
.ph-title {
  font-family: var(--display); font-size: 40px; font-weight: 800;
  line-height: 1; letter-spacing: -.02em; color: var(--text);
}
.ph-actions { display:flex; gap:8px; align-items:center; }

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn {
  padding: 8px 18px; border-radius: 6px;
  font-family: var(--sans); font-size: 12px; font-weight: 600;
  cursor: pointer; transition: all .15s;
  border: 1px solid var(--bord2); background: transparent; color: var(--text2);
  letter-spacing: .03em;
}
.btn:hover { border-color:var(--text3); color:var(--text); }
.btn:disabled { opacity:.4; cursor:not-allowed; }
.btn-green {
  border-color: var(--green); background: var(--glow2); color: var(--green);
}
.btn-green:hover {
  background: var(--green); color: #07090b;
  box-shadow: 0 0 24px rgba(0,232,122,.35);
}
.btn-sm { padding:6px 12px; font-size:11px; }

/* ‚îÄ‚îÄ KPI GRID ‚îÄ‚îÄ */
.kpi-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:24px; }
.kpi {
  background: var(--surf); border: 1px solid var(--border);
  border-radius: 10px; padding: 18px; position:relative; overflow:hidden;
  transition: border-color .2s, transform .2s;
}
.kpi:hover { border-color:var(--bord2); transform:translateY(-1px); }
.kpi.accent::before {
  content:''; position:absolute; top:0; left:0; right:0; height:2px;
  background: var(--green); box-shadow: 0 0 12px var(--green);
}
.kpi.accent2::before { background:var(--yellow); box-shadow:0 0 12px var(--yellow); }
.kpi-label {
  font-family:var(--mono); font-size:9px; letter-spacing:.14em;
  color:var(--text3); text-transform:uppercase; margin-bottom:10px;
}
.kpi-val { font-family:var(--display); font-size:32px; font-weight:800; line-height:1; margin-bottom:4px; letter-spacing:-.02em; }
.kpi-val.g { color:var(--green); text-shadow:0 0 20px rgba(0,232,122,.25); }
.kpi-val.w { color:var(--text); }
.kpi-val.y { color:var(--yellow); }
.kpi-val.r { color:var(--red); }
.kpi-sub { font-family:var(--mono); font-size:10px; color:var(--text3); }

/* ‚îÄ‚îÄ TICKER ‚îÄ‚îÄ */
.ticker {
  background: var(--surf); border: 1px solid var(--border);
  border-radius: 8px; overflow: hidden; margin-bottom: 24px;
  position: relative; height: 42px;
}
.ticker::before, .ticker::after {
  content:''; position:absolute; top:0; bottom:0; width:80px; z-index:2; pointer-events:none;
}
.ticker::before { left:0; background:linear-gradient(to right, var(--surf), transparent); }
.ticker::after  { right:0; background:linear-gradient(to left, var(--surf), transparent); }
.ticker-track {
  display:flex; gap:48px; padding:12px 24px;
  animation: scrollticker 30s linear infinite;
  white-space: nowrap; width: max-content;
}
@keyframes scrollticker { from{transform:translateX(0)} to{transform:translateX(-50%)} }
.tick-item { display:inline-flex; align-items:center; gap:10px; font-family:var(--mono); font-size:11px; color:var(--text2); }
.tick-match { color:var(--text); font-weight:700; font-size:11px; }
.tick-ev { color:var(--green); font-weight:700; }
.tick-div { color:var(--border); }

/* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
.filter-bar { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; gap:10px; flex-wrap:wrap; }
.filter-chips { display:flex; gap:6px; flex-wrap:wrap; }
.chip {
  padding:5px 12px; border-radius:100px;
  font-family:var(--mono); font-size:10px; letter-spacing:.06em;
  cursor:pointer; border:1px solid var(--border);
  background:transparent; color:var(--text3); transition:all .15s;
}
.chip:hover { color:var(--text2); border-color:var(--bord2); }
.chip.active { border-color:var(--green); color:var(--green); background:var(--glow2); }

/* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
.table-wrap { background:var(--surf); border:1px solid var(--border); border-radius:10px; overflow:hidden; }
.table-head {
  display:grid; padding:10px 20px;
  background:var(--bg3); border-bottom:1px solid var(--border);
}
.th {
  font-family:var(--mono); font-size:9px; letter-spacing:.12em;
  color:var(--text3); text-transform:uppercase; cursor:pointer; user-select:none;
  transition:color .15s;
}
.th:hover { color:var(--text2); }
.th.desc::after { content:' ‚Üì'; color:var(--green); }
.th.asc::after  { content:' ‚Üë'; color:var(--green); }
.table-row {
  display:grid; padding:14px 20px;
  border-bottom: 1px solid var(--border);
  align-items: center; cursor:pointer; transition:background .15s;
}
.table-row:last-child { border-bottom:none; }
.table-row:hover { background:rgba(255,255,255,.018); }
.match-name { font-size:13px; font-weight:500; color:var(--text); }
.match-meta { font-family:var(--mono); font-size:10px; color:var(--text3); margin-top:2px; }
.cell-mono { font-family:var(--mono); font-size:12px; color:var(--text2); }
.badge {
  display:inline-block; padding:3px 9px; border-radius:100px;
  font-family:var(--mono); font-size:10px; font-weight:700; letter-spacing:.04em;
}
.b-g  { color:var(--green);  background:rgba(0,232,122,.08);  border:1px solid rgba(0,232,122,.2); }
.b-y  { color:var(--yellow); background:rgba(245,192,50,.08);  border:1px solid rgba(245,192,50,.2); }
.b-r  { color:var(--red);    background:rgba(255,61,90,.08);   border:1px solid rgba(255,61,90,.2); }
.b-gr { color:var(--text3);  background:var(--border);         border:1px solid var(--bord2); }

/* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
.pbar { height:3px; background:var(--border); border-radius:2px; overflow:hidden; margin-top:5px; }
.pbar-fill { height:100%; border-radius:2px; transition:width 1.2s cubic-bezier(.4,0,.2,1); }
.pbar-fill.g { background:var(--green); box-shadow:0 0 6px var(--green); }
.pbar-fill.y { background:var(--yellow); }
.pbar-fill.d { background:var(--text3); }

/* ‚îÄ‚îÄ SKELETON ‚îÄ‚îÄ */
.sk {
  background: linear-gradient(90deg, var(--surf) 25%, var(--surf2) 50%, var(--surf) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite; border-radius:6px; height:18px;
}
@keyframes shimmer { from{background-position:200% 0} to{background-position:-200% 0} }
.sk-rows { padding:16px; display:flex; flex-direction:column; gap:14px; }
.sk-row  { display:flex; gap:12px; }

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.empty { padding:56px 24px; text-align:center; }
.empty-icon { font-size:40px; margin-bottom:14px; opacity:.4; }
.empty-title { font-family:var(--display); font-size:18px; font-weight:700; color:var(--text2); margin-bottom:6px; }
.empty-sub { font-size:13px; color:var(--text3); line-height:1.6; }

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.overlay {
  position:fixed; inset:0; z-index:800;
  background:rgba(0,0,0,.8); backdrop-filter:blur(8px);
  display:none; align-items:center; justify-content:center;
}
.overlay.open { display:flex; animation:pageIn .2s ease; }
.modal {
  background:var(--bg2); border:1px solid var(--bord2);
  border-radius:14px; padding:30px; width:520px; max-width:95vw;
  position:relative; box-shadow:0 60px 100px rgba(0,0,0,.7);
}
.modal-close {
  position:absolute; top:18px; right:18px;
  background:none; border:none; color:var(--text3);
  font-size:20px; cursor:pointer; transition:color .15s; line-height:1;
}
.modal-close:hover { color:var(--text); }
.modal-title { font-family:var(--display); font-size:26px; font-weight:800; color:var(--text); margin-bottom:4px; letter-spacing:-.02em; }
.modal-sub { font-family:var(--mono); font-size:11px; color:var(--text3); margin-bottom:22px; }
.modal-kpis { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:22px; }
.mk { background:var(--surf); border:1px solid var(--border); border-radius:8px; padding:12px; text-align:center; }
.mk-label { font-family:var(--mono); font-size:9px; color:var(--text3); margin-bottom:6px; letter-spacing:.1em; }
.mk-val { font-family:var(--display); font-size:20px; font-weight:800; }
.prob-section-title { font-family:var(--mono); font-size:9px; color:var(--text3); letter-spacing:.14em; text-transform:uppercase; margin-bottom:14px; }
.prob-row { margin-bottom:14px; }
.prob-row-label { font-size:12px; color:var(--text2); margin-bottom:8px; font-weight:500; }
.prob-bars { display:flex; flex-direction:column; gap:5px; }
.prob-bar-line { display:flex; align-items:center; gap:10px; }
.prob-bar-tag { font-family:var(--mono); font-size:9px; letter-spacing:.08em; width:54px; text-align:right; flex-shrink:0; }
.prob-bar-track { flex:1; height:5px; background:var(--border); border-radius:3px; overflow:hidden; }
.prob-bar-fill  { height:100%; border-radius:3px; }
.prob-bar-pct   { font-family:var(--mono); font-size:10px; width:38px; text-align:right; flex-shrink:0; }

/* ‚îÄ‚îÄ BANKROLL PAGE ‚îÄ‚îÄ */
.bankroll-hero {
  display:grid; grid-template-columns:1fr 280px; gap:20px; margin-bottom:24px;
}
.bh-main {
  background: linear-gradient(135deg, var(--surf) 0%, rgba(0,232,122,.06) 100%);
  border:1px solid rgba(0,232,122,.2); border-radius:12px; padding:28px;
  position:relative; overflow:hidden;
}
.bh-main::before {
  content:''; position:absolute; top:-40px; right:-40px;
  width:180px; height:180px;
  background:radial-gradient(circle, rgba(0,232,122,.12) 0%, transparent 70%);
}
.bh-label { font-family:var(--mono); font-size:10px; color:var(--text3); letter-spacing:.12em; text-transform:uppercase; margin-bottom:10px; }
.bh-amount { font-family:var(--display); font-size:64px; font-weight:800; color:var(--green); text-shadow:0 0 40px rgba(0,232,122,.3); line-height:1; letter-spacing:-.03em; }
.bh-sub { font-size:13px; color:var(--text2); margin-top:8px; }
.bh-change {
  display:inline-flex; align-items:center; gap:6px;
  margin-top:14px; padding:6px 12px; border-radius:100px;
  font-family:var(--mono); font-size:12px; font-weight:700;
}
.bh-change.pos { background:rgba(0,232,122,.1); color:var(--green); border:1px solid rgba(0,232,122,.2); }
.bh-change.neg { background:rgba(255,61,90,.1); color:var(--red); border:1px solid rgba(255,61,90,.2); }
.bh-side { display:flex; flex-direction:column; gap:12px; }
.bh-stat {
  flex:1; background:var(--surf); border:1px solid var(--border);
  border-radius:10px; padding:16px;
}
.bh-stat-label { font-family:var(--mono); font-size:9px; color:var(--text3); letter-spacing:.12em; text-transform:uppercase; margin-bottom:8px; }
.bh-stat-val { font-family:var(--display); font-size:28px; font-weight:800; line-height:1; }

/* ‚îÄ‚îÄ ROI CHART ‚îÄ‚îÄ */
.chart-card {
  background:var(--surf); border:1px solid var(--border);
  border-radius:10px; padding:22px; margin-bottom:20px;
}
.chart-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
.chart-title { font-family:var(--mono); font-size:10px; color:var(--text3); letter-spacing:.12em; text-transform:uppercase; }
.chart-legend { display:flex; gap:16px; }
.leg-item { display:flex; align-items:center; gap:6px; font-family:var(--mono); font-size:10px; color:var(--text3); }
.leg-dot { width:8px; height:8px; border-radius:50%; }
.svg-chart { width:100%; overflow:visible; }

/* ‚îÄ‚îÄ STAKE CALCULATOR ‚îÄ‚îÄ */
.calc-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.calc-card {
  background:var(--surf); border:1px solid var(--border);
  border-radius:10px; padding:22px;
}
.calc-title { font-family:var(--mono); font-size:10px; color:var(--text3); letter-spacing:.12em; text-transform:uppercase; margin-bottom:18px; }
.input-group { margin-bottom:16px; }
.input-label { font-family:var(--mono); font-size:10px; color:var(--text3); letter-spacing:.1em; text-transform:uppercase; margin-bottom:8px; display:block; }
.input-field {
  width:100%; padding:10px 14px;
  background:var(--bg3); border:1px solid var(--border);
  border-radius:6px; color:var(--text);
  font-family:var(--mono); font-size:14px;
  outline:none; transition:border-color .2s;
}
.input-field:focus { border-color:var(--green); box-shadow:0 0 0 2px rgba(0,232,122,.1); }
.input-field::placeholder { color:var(--text3); }
.calc-result {
  background: linear-gradient(135deg, var(--bg3) 0%, rgba(0,232,122,.05) 100%);
  border:1px solid rgba(0,232,122,.2); border-radius:8px; padding:16px;
  margin-top:16px;
}
.calc-result-row { display:flex; justify-content:space-between; align-items:center; padding:6px 0; border-bottom:1px solid var(--border); }
.calc-result-row:last-child { border-bottom:none; }
.calc-result-label { font-size:13px; color:var(--text2); }
.calc-result-val { font-family:var(--mono); font-size:14px; font-weight:700; }

.method-tabs { display:flex; gap:6px; margin-bottom:16px; }
.method-tab {
  flex:1; padding:8px; border-radius:6px; text-align:center;
  font-family:var(--mono); font-size:10px; cursor:pointer;
  border:1px solid var(--border); background:transparent; color:var(--text3);
  transition:all .15s; letter-spacing:.06em;
}
.method-tab:hover { color:var(--text2); border-color:var(--bord2); }
.method-tab.active { border-color:var(--green); color:var(--green); background:var(--glow2); }

/* ‚îÄ‚îÄ HISTORY ‚îÄ‚îÄ */
.history-filters { display:flex; gap:8px; margin-bottom:16px; flex-wrap:wrap; }

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:900px) {
  .layout { grid-template-columns:1fr; }
  .sidebar { display:none; }
  .kpi-grid { grid-template-columns:repeat(2,1fr); }
  .bankroll-hero { grid-template-columns:1fr; }
  .calc-grid { grid-template-columns:1fr; }
  .main { padding:16px; }
}
</style>
</head>
<body>

<!-- NAV -->
<nav class="nav">
  <a class="nav-logo" href="#">
    <div class="egg"></div>
    Egg<span>Stats</span>
  </a>
  <div class="nav-tabs">
    <button class="ntab active" onclick="goPage('feed',this)">Feed</button>
    <button class="ntab" onclick="goPage('bankroll',this)">Bankroll</button>
    <button class="ntab" onclick="goPage('history',this)">Hist√≥rico</button>
    <button class="ntab" onclick="goPage('calculator',this)">Calculadora</button>
  </div>
  <div class="nav-right">
    <div class="pulse-badge">
      <div class="pdot loading" id="pdot"></div>
      <span id="ptext">conectando</span>
    </div>
    <div class="nav-clock" id="clock"></div>
    <span class="plan-pill plan-pro" id="planBadge" onclick="goPage('bankroll',document.querySelectorAll('.ntab')[1])">PRO</span>
  </div>
</nav>

<div class="layout">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sb-section">
    <div class="sb-label">Menu</div>
    <button class="sb-nav-item active" onclick="goPage('feed',document.querySelectorAll('.ntab')[0]);sbActive(this)"><div class="sb-icon">‚ö°</div>Feed ao vivo</button>
    <button class="sb-nav-item" onclick="goPage('bankroll',document.querySelectorAll('.ntab')[1]);sbActive(this)"><div class="sb-icon">üí∞</div>Bankroll</button>
    <button class="sb-nav-item" onclick="goPage('history',document.querySelectorAll('.ntab')[2]);sbActive(this)"><div class="sb-icon">üìã</div>Hist√≥rico</button>
    <button class="sb-nav-item" onclick="goPage('calculator',document.querySelectorAll('.ntab')[3]);sbActive(this)"><div class="sb-icon">üßÆ</div>Calculadora</button>
  </div>

  <div class="sb-section">
    <div class="sb-label">Filtrar liga</div>
    <button class="sb-nav-item active" id="sbAll" onclick="sbFilter('',this)"><div class="sb-icon">üåç</div>Todas</button>
    <button class="sb-nav-item" onclick="sbFilter('PL',this)"><div class="sb-icon">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø</div>Premier League</button>
    <button class="sb-nav-item" onclick="sbFilter('SA',this)"><div class="sb-icon">üáÆüáπ</div>Serie A</button>
    <button class="sb-nav-item" onclick="sbFilter('PD',this)"><div class="sb-icon">üá™üá∏</div>La Liga</button>
    <button class="sb-nav-item" onclick="sbFilter('BL1',this)"><div class="sb-icon">üá©üá™</div>Bundesliga</button>
    <button class="sb-nav-item" onclick="sbFilter('FL1',this)"><div class="sb-icon">üá´üá∑</div>Ligue 1</button>
    <button class="sb-nav-item" onclick="sbFilter('BSA',this)"><div class="sb-icon">üáßüá∑</div>Brasileir√£o</button>
  </div>

  <div class="sb-bankroll">
    <div class="sb-br-label">Bankroll atual</div>
    <div class="sb-br-val" id="sbBankroll">R$ ‚Äî</div>
    <div class="sb-br-sub" id="sbBankrollSub">carregando...</div>
    <div class="sb-br-change" id="sbChange"></div>
  </div>

  <div class="sb-stats">
    <div class="sb-stat">
      <span class="sb-stat-label">ROI total</span>
      <span class="sb-stat-val" id="sbROI" style="color:var(--green)">‚Äî</span>
    </div>
    <div class="sb-stat">
      <span class="sb-stat-label">Hit rate</span>
      <span class="sb-stat-val" id="sbHit" style="color:var(--text)">‚Äî</span>
    </div>
    <div class="sb-stat">
      <span class="sb-stat-label">Apostas</span>
      <span class="sb-stat-val" id="sbTotal" style="color:var(--text)">‚Äî</span>
    </div>
  </div>
</aside>

<!-- MAIN CONTENT -->
<main class="main">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE: FEED
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="page-feed">
  <div class="ph">
    <div>
      <div class="ph-eyebrow">// OPORTUNIDADES EM TEMPO REAL</div>
      <div class="ph-title">Feed ao Vivo</div>
    </div>
    <div class="ph-actions">
      <span id="lastUpdate" style="font-family:var(--mono);font-size:10px;color:var(--text3)"></span>
      <button class="btn btn-green" onclick="loadFeed()" id="btnFeed">‚Üª Atualizar</button>
    </div>
  </div>

  <!-- KPIs -->
  <div class="kpi-grid" id="feedKpis">
    <div class="kpi"><div class="sk"></div></div>
    <div class="kpi"><div class="sk" style="height:14px;margin-top:12px"></div></div>
    <div class="kpi"><div class="sk" style="height:14px;margin-top:12px"></div></div>
    <div class="kpi"><div class="sk" style="height:14px;margin-top:12px"></div></div>
  </div>

  <!-- Ticker -->
  <div class="ticker" id="tickerEl" style="display:none">
    <div class="ticker-track" id="tickerTrack"></div>
  </div>

  <!-- Filters -->
  <div class="filter-bar">
    <div class="filter-chips" id="confChips">
      <button class="chip active" onclick="filterConf('all',this)">Todos</button>
      <button class="chip" onclick="filterConf('HIGH',this)">üî• HIGH</button>
      <button class="chip" onclick="filterConf('MEDIUM',this)">‚ö° MEDIUM</button>
      <button class="chip" onclick="filterConf('LOW',this)">LOW</button>
    </div>
    <div style="display:flex;gap:6px;align-items:center">
      <span style="font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:.1em">ORDENAR</span>
      <button class="chip active" onclick="sortFeed('ev',this)">EV</button>
      <button class="chip" onclick="sortFeed('edge',this)">EDGE</button>
      <button class="chip" onclick="sortFeed('odd',this)">ODD</button>
    </div>
  </div>

  <!-- Table -->
  <div class="table-wrap">
    <div class="table-head" style="grid-template-columns:2fr 90px 90px 90px 90px 80px 90px">
      <div class="th">PARTIDA</div>
      <div class="th">P(MODELO)</div>
      <div class="th">ODD</div>
      <div class="th">EDGE</div>
      <div class="th">EV</div>
      <div class="th">CONF.</div>
      <div class="th">A√á√ÉO</div>
    </div>
    <div id="feedBody">
      <div class="sk-rows">
        <div class="sk-row"><div class="sk" style="flex:2"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div></div>
        <div class="sk-row"><div class="sk" style="flex:2"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div></div>
        <div class="sk-row"><div class="sk" style="flex:2"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE: BANKROLL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-bankroll">
  <div class="ph">
    <div>
      <div class="ph-eyebrow">// GEST√ÉO DE BANCA</div>
      <div class="ph-title">Bankroll</div>
    </div>
    <div class="ph-actions">
      <button class="btn" onclick="showDepositModal()">+ Dep√≥sito</button>
      <button class="btn btn-green" onclick="loadBankroll()">‚Üª Atualizar</button>
    </div>
  </div>

  <!-- Hero -->
  <div class="bankroll-hero">
    <div class="bh-main">
      <div class="bh-label">Banca total</div>
      <div class="bh-amount" id="bhAmount">R$ 0,00</div>
      <div class="bh-sub" id="bhSub">Inicialize sua banca para come√ßar</div>
      <div class="bh-change pos" id="bhChange" style="display:none"></div>
    </div>
    <div class="bh-side">
      <div class="bh-stat">
        <div class="bh-stat-label">Lucro total</div>
        <div class="bh-stat-val" id="bhProfit" style="color:var(--green)">R$ 0,00</div>
      </div>
      <div class="bh-stat">
        <div class="bh-stat-label">Apostas ativas</div>
        <div class="bh-stat-val" id="bhActive" style="color:var(--text)">0</div>
      </div>
      <div class="bh-stat">
        <div class="bh-stat-label">Risco atual</div>
        <div class="bh-stat-val" id="bhRisk" style="color:var(--yellow)">0%</div>
      </div>
    </div>
  </div>

  <!-- ROI Chart -->
  <div class="chart-card">
    <div class="chart-header">
      <div class="chart-title">Evolu√ß√£o do Bankroll</div>
      <div class="chart-legend">
        <div class="leg-item"><div class="leg-dot" style="background:var(--green)"></div>Banca</div>
        <div class="leg-item"><div class="leg-dot" style="background:var(--blue)"></div>ROI %</div>
      </div>
    </div>
    <svg class="svg-chart" id="roiChart" height="140" viewBox="0 0 800 140" preserveAspectRatio="none"></svg>
  </div>

  <!-- KPIs -->
  <div class="kpi-grid" id="bankrollKpis">
    <div class="kpi accent">
      <div class="kpi-label">ROI Total</div>
      <div class="kpi-val g" id="bkROI">0%</div>
      <div class="kpi-sub">retorno sobre banca inicial</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Hit Rate</div>
      <div class="kpi-val w" id="bkHit">0%</div>
      <div class="kpi-sub" id="bkHitSub">apostas ganhas</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Unidades</div>
      <div class="kpi-val w" id="bkUnits">0u</div>
      <div class="kpi-sub">lucro em unidades</div>
    </div>
    <div class="kpi accent2">
      <div class="kpi-label">Drawdown m√°x.</div>
      <div class="kpi-val y" id="bkDD">0%</div>
      <div class="kpi-sub">queda m√°xima da banca</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE: HIST√ìRICO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-history">
  <div class="ph">
    <div>
      <div class="ph-eyebrow">// REGISTRO DE APOSTAS</div>
      <div class="ph-title">Hist√≥rico</div>
    </div>
    <div class="ph-actions">
      <button class="btn" onclick="exportCSV()">‚Üì Exportar CSV</button>
      <button class="btn btn-green" onclick="syncAndSettle()">‚ö° Sincronizar resultados</button>
    </div>
  </div>

  <div class="history-filters">
    <button class="chip active" onclick="filterHistory('all',this)">Todas</button>
    <button class="chip" onclick="filterHistory('WIN',this)">‚úÖ Ganhas</button>
    <button class="chip" onclick="filterHistory('LOSS',this)">‚ùå Perdidas</button>
    <button class="chip" onclick="filterHistory('pending',this)">‚è≥ Pendentes</button>
  </div>

  <div class="table-wrap">
    <div class="table-head" style="grid-template-columns:2fr 80px 80px 80px 80px 90px 90px">
      <div class="th">PARTIDA</div>
      <div class="th">PICK</div>
      <div class="th">ODD</div>
      <div class="th">STAKE</div>
      <div class="th">RESULTADO</div>
      <div class="th">LUCRO</div>
      <div class="th">CONF.</div>
    </div>
    <div id="historyBody">
      <div class="sk-rows">
        <div class="sk-row"><div class="sk" style="flex:2"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div></div>
        <div class="sk-row"><div class="sk" style="flex:2"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div></div>
        <div class="sk-row"><div class="sk" style="flex:2"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE: CALCULADORA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-calculator">
  <div class="ph">
    <div>
      <div class="ph-eyebrow">// GEST√ÉO DE RISCO</div>
      <div class="ph-title">Calculadora de Stake</div>
    </div>
  </div>

  <div class="calc-grid">
    <!-- Calculadora principal -->
    <div class="calc-card">
      <div class="calc-title">Quanto apostar?</div>

      <div class="method-tabs">
        <button class="method-tab active" onclick="setMethod('kelly',this)">Kelly Criterion</button>
        <button class="method-tab" onclick="setMethod('flat',this)">Flat Stake</button>
        <button class="method-tab" onclick="setMethod('percent',this)">% da Banca</button>
      </div>

      <div class="input-group">
        <label class="input-label">Sua banca atual (R$)</label>
        <input class="input-field" type="number" id="calcBankroll" placeholder="Ex: 1000" oninput="calcStake()">
      </div>
      <div class="input-group">
        <label class="input-label">Probabilidade do modelo (%)</label>
        <input class="input-field" type="number" id="calcProb" placeholder="Ex: 55.5" oninput="calcStake()">
      </div>
      <div class="input-group">
        <label class="input-label">Odd do mercado</label>
        <input class="input-field" type="number" id="calcOdd" placeholder="Ex: 2.10" oninput="calcStake()">
      </div>
      <div id="methodExtra"></div>

      <div class="calc-result" id="calcResult" style="display:none">
        <div class="calc-result-row">
          <span class="calc-result-label">Stake recomendada</span>
          <span class="calc-result-val" id="crStake" style="color:var(--green)">‚Äî</span>
        </div>
        <div class="calc-result-row">
          <span class="calc-result-label">% da banca</span>
          <span class="calc-result-val" id="crPct" style="color:var(--text)">‚Äî</span>
        </div>
        <div class="calc-result-row">
          <span class="calc-result-label">Lucro potencial</span>
          <span class="calc-result-val" id="crProfit" style="color:var(--green)">‚Äî</span>
        </div>
        <div class="calc-result-row">
          <span class="calc-result-label">EV desta aposta</span>
          <span class="calc-result-val" id="crEV" style="color:var(--yellow)">‚Äî</span>
        </div>
        <div class="calc-result-row">
          <span class="calc-result-label">Edge sobre o mercado</span>
          <span class="calc-result-val" id="crEdge" style="color:var(--text)">‚Äî</span>
        </div>
      </div>
    </div>

    <!-- Guia explicativo -->
    <div class="calc-card">
      <div class="calc-title">Entendendo os m√©todos</div>

      <div style="display:flex;flex-direction:column;gap:16px;margin-top:4px">
        <div style="padding:16px;background:var(--bg3);border-radius:8px;border:1px solid var(--border)">
          <div style="font-family:var(--mono);font-size:11px;color:var(--green);margin-bottom:8px;letter-spacing:.06em">KELLY CRITERION</div>
          <div style="font-size:13px;color:var(--text2);line-height:1.7">O m√©todo matem√°tico mais usado por traders profissionais. Calcula a stake ideal baseada no <strong style="color:var(--text)">edge real sobre o mercado</strong>. Maximiza crescimento de longo prazo sem arriscar ru√≠na.</div>
          <div style="font-family:var(--mono);font-size:11px;color:var(--text3);margin-top:10px;padding:8px;background:var(--surf);border-radius:4px">f = (p √ó b ‚àí q) / b</div>
        </div>

        <div style="padding:16px;background:var(--bg3);border-radius:8px;border:1px solid var(--border)">
          <div style="font-family:var(--mono);font-size:11px;color:var(--blue);margin-bottom:8px;letter-spacing:.06em">FLAT STAKE</div>
          <div style="font-size:13px;color:var(--text2);line-height:1.7">Apostas com valor fixo. Simples e seguro para iniciantes. N√£o maximiza retorno mas <strong style="color:var(--text)">protege a banca</strong> em sequ√™ncias negativas.</div>
        </div>

        <div style="padding:16px;background:var(--bg3);border-radius:8px;border:1px solid var(--border)">
          <div style="font-family:var(--mono);font-size:11px;color:var(--yellow);margin-bottom:8px;letter-spacing:.06em">% DA BANCA</div>
          <div style="font-size:13px;color:var(--text2);line-height:1.7">Aposta uma porcentagem fixa da banca atual. Escala com o crescimento e reduz automaticamente em drawdowns. Recomendado: <strong style="color:var(--text)">1% a 3%</strong> por aposta.</div>
        </div>
      </div>
    </div>
  </div>
</div>

</main>
</div>

<!-- ‚îÄ‚îÄ MODAL DETALHE ‚îÄ‚îÄ -->
<div class="overlay" id="detailOverlay" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <div class="modal-title" id="mTitle"></div>
    <div class="modal-sub" id="mSub"></div>
    <div class="modal-kpis" id="mKpis"></div>
    <div class="prob-section-title">PROBABILIDADES ‚Äî MODELO VS MERCADO</div>
    <div id="mProbs"></div>
    <div style="display:flex;gap:10px;margin-top:20px" id="mActions"></div>
  </div>
</div>

<!-- ‚îÄ‚îÄ MODAL DEP√ìSITO ‚îÄ‚îÄ -->
<div class="overlay" id="depositOverlay" onclick="if(event.target===this)closeDeposit()">
  <div class="modal" style="max-width:400px">
    <button class="modal-close" onclick="closeDeposit()">‚úï</button>
    <div class="modal-title">Inicializar Banca</div>
    <div class="modal-sub" style="margin-bottom:20px">Define o valor inicial da sua banca para rastrear ROI e stakes</div>
    <div class="input-group">
      <label class="input-label">Valor inicial (R$)</label>
      <input class="input-field" type="number" id="depositAmount" placeholder="Ex: 1000">
    </div>
    <button class="btn btn-green" style="width:100%;margin-top:8px;padding:12px" onclick="saveDeposit()">Confirmar</button>
  </div>
</div>

<script>
const API = '';

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let allOpps = [], filtOpps = [], sortKey = 'ev', sortDir = 'desc';
let activeConf = 'all', activeLeague = '';
let historyFilter = 'all';
let calcMethod = 'kelly';
let bankrollData = { initial: 0, current: 0, history: [] };

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
loadFeed();
loadBankroll();
loadSidebar();
startClock();

// ‚îÄ‚îÄ CLOCK ‚îÄ‚îÄ
function startClock() {
  setInterval(() => {
    document.getElementById('clock').textContent =
      new Date().toLocaleTimeString('pt-BR', { hour:'2-digit', minute:'2-digit', second:'2-digit' });
  }, 1000);
}

// ‚îÄ‚îÄ STATUS ‚îÄ‚îÄ
function setStatus(s, t) {
  document.getElementById('pdot').className = 'pdot ' + s;
  document.getElementById('ptext').textContent = t;
}

// ‚îÄ‚îÄ PAGE NAV ‚îÄ‚îÄ
function goPage(name, navBtn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.ntab').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  if (navBtn) navBtn.classList.add('active');
  if (name === 'history')    loadHistory();
  if (name === 'bankroll')   loadBankroll();
  if (name === 'calculator') prefillCalc();
}

function sbActive(btn) {
  document.querySelectorAll('.sidebar .sb-nav-item').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

function sbFilter(league, btn) {
  activeLeague = league;
  document.querySelectorAll('.sb-section .sb-nav-item').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  applyFilters();
}

// ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ
function filterConf(level, btn) {
  activeConf = level;
  document.querySelectorAll('#confChips .chip').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  applyFilters();
}

function sortFeed(key, btn) {
  if (sortKey === key) sortDir = sortDir === 'desc' ? 'asc' : 'desc';
  else { sortKey = key; sortDir = 'desc'; }
  document.querySelectorAll('.filter-bar .chip').forEach(b => {
    b.classList.remove('active');
    b.className = b.className.replace(/ desc| asc/g, '');
  });
  btn.classList.add('active');
  applyFilters();
}

function applyFilters() {
  let f = [...allOpps];
  if (activeLeague) f = f.filter(o => o.league === activeLeague);
  if (activeConf !== 'all') f = f.filter(o => o.confidence === activeConf);
  f.sort((a, b) => sortDir === 'desc' ? (b[sortKey]||0) - (a[sortKey]||0) : (a[sortKey]||0) - (b[sortKey]||0));
  filtOpps = f;
  renderFeedTable(f);
}

// ‚îÄ‚îÄ LOAD FEED ‚îÄ‚îÄ
async function loadFeed() {
  setStatus('loading', 'buscando...');
  const btn = document.getElementById('btnFeed');
  btn.disabled = true; btn.textContent = '‚Üª Buscando...';
  document.getElementById('feedBody').innerHTML = skRows(4);

  try {
    const data = await fetch(API + '/api/opportunities').then(r => r.json());
    allOpps = data.top || [];
    filtOpps = [...allOpps];

    const high = allOpps.filter(o => o.confidence === 'HIGH').length;
    const avgEV = allOpps.length ? (allOpps.reduce((s,o) => s+o.ev, 0)/allOpps.length*100).toFixed(1) : '0.0';
    const maxEdge = allOpps.length ? (Math.max(...allOpps.map(o=>o.edge))*100).toFixed(1) : '0.0';

    document.getElementById('feedKpis').innerHTML = `
      <div class="kpi accent">
        <div class="kpi-label">Oportunidades EV+</div>
        <div class="kpi-val g">${data.count}</div>
        <div class="kpi-sub">encontradas agora</div>
      </div>
      <div class="kpi ${high > 0 ? 'accent' : ''}">
        <div class="kpi-label">HIGH Confidence</div>
        <div class="kpi-val ${high > 0 ? 'g' : 'w'}">${high}</div>
        <div class="kpi-sub">edge > 6% e EV > 8%</div>
      </div>
      <div class="kpi accent2">
        <div class="kpi-label">EV M√©dio</div>
        <div class="kpi-val ${parseFloat(avgEV) > 5 ? 'g' : 'y'}">+${avgEV}%</div>
        <div class="kpi-sub">retorno esperado por aposta</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Maior Edge</div>
        <div class="kpi-val g">+${maxEdge}%</div>
        <div class="kpi-sub">vantagem sobre o mercado</div>
      </div>`;

    // Ticker
    if (allOpps.length > 0) {
      const items = [...allOpps, ...allOpps].map(o =>
        `<span class="tick-item">
          <span class="tick-match">${o.match}</span>
          <span class="tick-div">¬∑</span>
          <span>${lgName(o.league)}</span>
          <span class="tick-div">¬∑</span>
          <span>${o.pick} @ ${o.odd}</span>
          <span class="tick-div">¬∑</span>
          <span class="tick-ev">EV +${(o.ev*100).toFixed(1)}%</span>
        </span>`).join('');
      document.getElementById('tickerTrack').innerHTML = items;
      document.getElementById('tickerEl').style.display = 'block';
    }

    document.getElementById('lastUpdate').textContent =
      'atualizado √†s ' + new Date().toLocaleTimeString('pt-BR', {hour:'2-digit',minute:'2-digit'});

    applyFilters();
    setStatus('live', 'ao vivo');

  } catch(e) {
    setStatus('err', 'offline');
    document.getElementById('feedBody').innerHTML = `
      <div class="empty">
        <div class="empty-icon">‚ö†Ô∏è</div>
        <div class="empty-title">Servidor n√£o encontrado</div>
        <div class="empty-sub">Verifique se o servidor est√° rodando em localhost:3000<br>e que o arquivo est√° na pasta do projeto</div>
      </div>`;
  }

  btn.disabled = false; btn.textContent = '‚Üª Atualizar';
}

function renderFeedTable(opps) {
  if (!opps.length) {
    document.getElementById('feedBody').innerHTML = `
      <div class="empty">
        <div class="empty-icon">üîç</div>
        <div class="empty-title">Nenhuma oportunidade</div>
        <div class="empty-sub">Tente remover filtros ou aguarde a pr√≥xima atualiza√ß√£o</div>
      </div>`;
    return;
  }

  document.getElementById('feedBody').innerHTML = opps.map((o, i) => {
    const pH   = (o.modelProb.home * 100).toFixed(1);
    const evP  = (o.ev * 100).toFixed(1);
    const edP  = (o.edge * 100).toFixed(1);
    const cc   = o.confidence === 'HIGH' ? 'b-g' : o.confidence === 'MEDIUM' ? 'b-y' : 'b-gr';
    const icon = o.confidence === 'HIGH' ? 'üî•' : o.confidence === 'MEDIUM' ? '‚ö°' : '';
    return `
    <div class="table-row" style="grid-template-columns:2fr 90px 90px 90px 90px 80px 90px"
         onclick="showDetail(${i})">
      <div>
        <div class="match-name">${o.match}</div>
        <div class="match-meta">${lgName(o.league)} ¬∑ ${o.pick}</div>
      </div>
      <div>
        <div class="cell-mono">${pH}%</div>
        <div class="pbar"><div class="pbar-fill g" style="width:${pH}%"></div></div>
      </div>
      <div class="cell-mono">${o.odd}</div>
      <div class="cell-mono" style="color:var(--green)">+${edP}%</div>
      <div><span class="badge b-g">+${evP}%</span></div>
      <div><span class="badge ${cc}">${icon} ${o.confidence}</span></div>
      <div>
        <button class="btn btn-green btn-sm" onclick="event.stopPropagation();addToBetLog(${i})">
          + Apostar
        </button>
      </div>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ DETAIL MODAL ‚îÄ‚îÄ
function showDetail(i) {
  const o = filtOpps[i];
  if (!o) return;

  document.getElementById('mTitle').textContent = o.match;
  document.getElementById('mSub').textContent = `${lgName(o.league)} ¬∑ Pick: ${o.pick} @ ${o.odd}`;

  const kpis = [
    { label:'EV', val:`+${(o.ev*100).toFixed(1)}%`, color:'var(--green)' },
    { label:'EDGE', val:`+${(o.edge*100).toFixed(1)}%`, color:'var(--green)' },
    { label:'ODD', val:o.odd, color:'var(--text)' },
    { label:'CONF.', val:o.confidence, color: o.confidence==='HIGH'?'var(--green)':o.confidence==='MEDIUM'?'var(--yellow)':'var(--text3)' },
  ];
  document.getElementById('mKpis').innerHTML = kpis.map(k =>
    `<div class="mk"><div class="mk-label">${k.label}</div><div class="mk-val" style="color:${k.color}">${k.val}</div></div>`
  ).join('');

  const sides  = ['home','draw','away'];
  const labels = ['Casa', 'Empate', 'Fora'];
  document.getElementById('mProbs').innerHTML = sides.map((s,i) => `
    <div class="prob-row">
      <div class="prob-row-label">${labels[i]}</div>
      <div class="prob-bars">
        <div class="prob-bar-line">
          <span class="prob-bar-tag" style="color:var(--green)">MODELO</span>
          <div class="prob-bar-track"><div class="prob-bar-fill" style="background:var(--green);width:${(o.modelProb[s]*100).toFixed(0)}%;box-shadow:0 0 6px var(--green)"></div></div>
          <span class="prob-bar-pct" style="color:var(--green)">${(o.modelProb[s]*100).toFixed(1)}%</span>
        </div>
        <div class="prob-bar-line">
          <span class="prob-bar-tag" style="color:var(--text3)">MERCADO</span>
          <div class="prob-bar-track"><div class="prob-bar-fill" style="background:var(--text3);width:${(o.marketProb[s]*100).toFixed(0)}%"></div></div>
          <span class="prob-bar-pct" style="color:var(--text3)">${(o.marketProb[s]*100).toFixed(1)}%</span>
        </div>
      </div>
    </div>`).join('');

  document.getElementById('mActions').innerHTML = `
    <button class="btn btn-green" style="flex:1" onclick="addToBetLog(${i});closeModal()">+ Registrar aposta</button>
    <button class="btn" style="flex:1" onclick="prefillFromPick(${i});goPage('calculator',document.querySelectorAll('.ntab')[3]);closeModal()">üßÆ Calcular stake</button>`;

  document.getElementById('detailOverlay').classList.add('open');
}

function closeModal() { document.getElementById('detailOverlay').classList.remove('open'); }

// ‚îÄ‚îÄ ADD TO BET LOG (local, ser√° sincronizado) ‚îÄ‚îÄ
function addToBetLog(i) {
  const o = filtOpps[i];
  const br = bankrollData.current || 0;
  const stake = br > 0 ? calcKelly(o.details.pModel, o.odd, br) : 10;

  const bets = getBets();
  bets.unshift({
    id:        Date.now(),
    match:     o.match,
    league:    o.league,
    pick:      o.pick,
    odd:       o.odd,
    stake:     Number(stake.toFixed(2)),
    pModel:    o.details.pModel,
    edge:      o.edge,
    ev:        o.ev,
    confidence:o.confidence,
    result:    null,
    profit:    null,
    date:      new Date().toISOString(),
  });
  saveBets(bets);

  // Atualiza banca (em risco)
  if (bankrollData.current > 0) {
    bankrollData.current -= stake;
    saveBankroll();
    loadBankroll();
    loadSidebar();
  }

  showToast(`‚úÖ ${o.match} ¬∑ ${o.pick} registrado!`);
}

// ‚îÄ‚îÄ BANKROLL ‚îÄ‚îÄ
function loadBankroll() {
  const saved = localStorage.getItem('eggstats_bankroll');
  if (saved) bankrollData = JSON.parse(saved);

  const bets   = getBets();
  const wins   = bets.filter(b => b.result === 'WIN').length;
  const total  = bets.filter(b => b.result !== null).length;
  const profit = bets.reduce((s, b) => s + (b.profit || 0), 0);
  const pending= bets.filter(b => b.result === null).length;
  const totalStaked = bets.reduce((s,b) => s + b.stake, 0);

  const current = bankrollData.current || 0;
  const initial = bankrollData.initial || 0;
  const roi     = initial > 0 ? ((current - initial) / initial * 100) : 0;
  const hitRate = total > 0 ? (wins / total * 100).toFixed(1) : '0.0';
  const risk    = current > 0 ? (pending * 10 / current * 100).toFixed(0) : 0;

  document.getElementById('bhAmount').textContent = fmt(current);
  document.getElementById('bhSub').textContent    = initial > 0 ? `Banca inicial: ${fmt(initial)}` : 'Clique em "+ Dep√≥sito" para inicializar';
  document.getElementById('bhProfit').textContent = (profit >= 0 ? '+' : '') + fmt(profit);
  document.getElementById('bhActive').textContent = pending;
  document.getElementById('bhRisk').textContent   = risk + '%';

  if (initial > 0) {
    const ch = document.getElementById('bhChange');
    ch.style.display = 'inline-flex';
    ch.className = 'bh-change ' + (roi >= 0 ? 'pos' : 'neg');
    ch.textContent = `${roi >= 0 ? '+' : ''}${roi.toFixed(1)}% desde o in√≠cio`;
  }

  document.getElementById('bkROI').textContent   = (roi >= 0 ? '+' : '') + roi.toFixed(1) + '%';
  document.getElementById('bkROI').className     = 'kpi-val ' + (roi >= 0 ? 'g' : 'r');
  document.getElementById('bkHit').textContent   = hitRate + '%';
  document.getElementById('bkHitSub').textContent= `${wins} de ${total} apostas`;
  document.getElementById('bkUnits').textContent = (profit >= 0 ? '+' : '') + (profit / Math.max(10,1)).toFixed(1) + 'u';
  document.getElementById('bkDD').textContent    = calcMaxDD(bankrollData.history || [current]) + '%';

  drawROIChart(bankrollData.history || [current]);
}

function drawROIChart(history) {
  const svg = document.getElementById('roiChart');
  if (!history.length) return;

  const W = 800, H = 140, pad = 10;
  const min = Math.min(...history);
  const max = Math.max(...history);
  const range = max - min || 1;

  const pts = history.map((v, i) => {
    const x = pad + (i / Math.max(history.length - 1, 1)) * (W - 2 * pad);
    const y = H - pad - ((v - min) / range) * (H - 2 * pad);
    return `${x.toFixed(1)},${y.toFixed(1)}`;
  }).join(' ');

  // Zero line
  const zeroY = H - pad - ((bankrollData.initial - min) / range) * (H - 2 * pad);

  svg.innerHTML = `
    <defs>
      <linearGradient id="areaGrad" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="var(--green)" stop-opacity=".25"/>
        <stop offset="100%" stop-color="var(--green)" stop-opacity="0"/>
      </linearGradient>
    </defs>
    <line x1="${pad}" y1="${zeroY.toFixed(1)}" x2="${W-pad}" y2="${zeroY.toFixed(1)}"
          stroke="var(--border)" stroke-width="1" stroke-dasharray="4,4"/>
    <polygon
      points="${pts} ${W-pad},${H-pad} ${pad},${H-pad}"
      fill="url(#areaGrad)"/>
    <polyline points="${pts}" fill="none"
      stroke="var(--green)" stroke-width="2"
      stroke-linejoin="round" stroke-linecap="round"
      style="filter:drop-shadow(0 0 4px var(--green))"/>`;
}

function calcMaxDD(history) {
  if (history.length < 2) return 0;
  let peak = history[0], maxDD = 0;
  for (const v of history) {
    if (v > peak) peak = v;
    const dd = (peak - v) / peak * 100;
    if (dd > maxDD) maxDD = dd;
  }
  return maxDD.toFixed(1);
}

function showDepositModal() { document.getElementById('depositOverlay').classList.add('open'); }
function closeDeposit()     { document.getElementById('depositOverlay').classList.remove('open'); }

function saveDeposit() {
  const v = parseFloat(document.getElementById('depositAmount').value);
  if (!v || v <= 0) return;
  bankrollData.initial = v;
  bankrollData.current = v;
  bankrollData.history = [v];
  saveBankroll();
  closeDeposit();
  loadBankroll();
  loadSidebar();
  showToast(`‚úÖ Banca inicializada: ${fmt(v)}`);
}

function saveBankroll() { localStorage.setItem('eggstats_bankroll', JSON.stringify(bankrollData)); }

// ‚îÄ‚îÄ HISTORY ‚îÄ‚îÄ
function loadHistory() {
  const bets = getBets();
  let f = [...bets];
  if (historyFilter === 'WIN')     f = f.filter(b => b.result === 'WIN');
  if (historyFilter === 'LOSS')    f = f.filter(b => b.result === 'LOSS');
  if (historyFilter === 'pending') f = f.filter(b => b.result === null);

  if (!f.length) {
    document.getElementById('historyBody').innerHTML = `
      <div class="empty">
        <div class="empty-icon">üìã</div>
        <div class="empty-title">Nenhuma aposta registrada</div>
        <div class="empty-sub">Clique em "+ Apostar" no feed para registrar picks</div>
      </div>`;
    return;
  }

  document.getElementById('historyBody').innerHTML = f.map(b => {
    const rClass = b.result === 'WIN' ? 'b-g' : b.result === 'LOSS' ? 'b-r' : 'b-gr';
    const rText  = b.result === 'WIN' ? '‚úÖ WIN' : b.result === 'LOSS' ? '‚ùå LOSS' : '‚è≥ ‚Äî';
    const pColor = !b.profit ? '' : b.profit > 0 ? 'color:var(--green)' : 'color:var(--red)';
    const pText  = b.profit != null ? (b.profit > 0 ? '+' : '') + fmt(b.profit) : '‚Äî';
    const cc     = b.confidence === 'HIGH' ? 'b-g' : b.confidence === 'MEDIUM' ? 'b-y' : 'b-gr';
    const date   = new Date(b.date).toLocaleDateString('pt-BR', { day:'2-digit', month:'2-digit' });
    return `
    <div class="table-row" style="grid-template-columns:2fr 80px 80px 80px 80px 90px 90px">
      <div>
        <div class="match-name">${b.match}</div>
        <div class="match-meta">${lgName(b.league)} ¬∑ ${date}</div>
      </div>
      <div><span class="badge ${cc}">${b.pick}</span></div>
      <div class="cell-mono">${b.odd}</div>
      <div class="cell-mono">${fmt(b.stake)}</div>
      <div><span class="badge ${rClass}">${rText}</span></div>
      <div class="cell-mono" style="${pColor}">${pText}</div>
      <div><span class="badge ${cc}">${b.confidence}</span></div>
    </div>`;
  }).join('');
}

function filterHistory(f, btn) {
  historyFilter = f;
  document.querySelectorAll('.history-filters .chip').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  loadHistory();
}

function exportCSV() {
  const bets = getBets();
  if (!bets.length) { showToast('Nenhuma aposta para exportar'); return; }
  const rows = [['Data','Partida','Liga','Pick','Odd','Stake','Resultado','Lucro','Confian√ßa','EV','Edge']];
  for (const b of bets) {
    rows.push([
      new Date(b.date).toLocaleDateString('pt-BR'),
      b.match, b.league, b.pick, b.odd, b.stake,
      b.result || 'Pendente', b.profit ?? '', b.confidence,
      (b.ev*100).toFixed(1)+'%', (b.edge*100).toFixed(1)+'%'
    ]);
  }
  const csv  = rows.map(r => r.join(',')).join('\n');
  const blob = new Blob([csv], { type:'text/csv' });
  const url  = URL.createObjectURL(blob);
  const a    = Object.assign(document.createElement('a'), { href:url, download:'egg-stats-picks.csv' });
  a.click(); URL.revokeObjectURL(url);
}

async function syncAndSettle() {
  showToast('‚è≥ Sincronizando resultados...');
  try {
    await fetch(API + '/api/sync-results', { method:'POST' });
    const d = await fetch(API + '/api/settle-bets', { method:'POST' }).then(r=>r.json());
    showToast(`‚úÖ ${d.settled} apostas liquidadas!`);
    loadHistory();
    loadBankroll();
    loadSidebar();
  } catch(e) { showToast('Erro: ' + e.message); }
}

// ‚îÄ‚îÄ CALCULATOR ‚îÄ‚îÄ
function setMethod(m, btn) {
  calcMethod = m;
  document.querySelectorAll('.method-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const extra = document.getElementById('methodExtra');
  if (m === 'percent') {
    extra.innerHTML = `<div class="input-group"><label class="input-label">% da banca a apostar</label><input class="input-field" type="number" id="calcPct" placeholder="Ex: 2" oninput="calcStake()"></div>`;
  } else if (m === 'flat') {
    extra.innerHTML = `<div class="input-group"><label class="input-label">Valor fixo (R$)</label><input class="input-field" type="number" id="calcFlat" placeholder="Ex: 50" oninput="calcStake()"></div>`;
  } else {
    extra.innerHTML = '';
  }
  calcStake();
}

function calcStake() {
  const bankroll = parseFloat(document.getElementById('calcBankroll').value) || 0;
  const prob     = parseFloat(document.getElementById('calcProb').value) / 100 || 0;
  const odd      = parseFloat(document.getElementById('calcOdd').value) || 0;

  if (!bankroll || !prob || !odd) { document.getElementById('calcResult').style.display='none'; return; }

  const b = odd - 1;
  const q = 1 - prob;
  const edge = prob - (1 / odd);
  const ev   = prob * odd - 1;

  let stake = 0;
  if (calcMethod === 'kelly') {
    const kelly = (prob * b - q) / b;
    stake = Math.max(0, kelly * 0.5 * bankroll); // Half-Kelly por seguran√ßa
  } else if (calcMethod === 'flat') {
    stake = parseFloat(document.getElementById('calcFlat')?.value) || 0;
  } else {
    const pct = parseFloat(document.getElementById('calcPct')?.value) / 100 || 0.02;
    stake = bankroll * pct;
  }

  const pct    = (stake / bankroll * 100).toFixed(2);
  const profit = stake * b;

  document.getElementById('calcResult').style.display = 'block';
  document.getElementById('crStake').textContent  = fmt(stake);
  document.getElementById('crPct').textContent    = pct + '% da banca';
  document.getElementById('crProfit').textContent = '+' + fmt(profit);
  document.getElementById('crEV').textContent     = (ev >= 0 ? '+' : '') + (ev*100).toFixed(1) + '%';
  document.getElementById('crEdge').textContent   = (edge >= 0 ? '+' : '') + (edge*100).toFixed(1) + '%';
  document.getElementById('crEV').style.color     = ev > 0 ? 'var(--green)' : 'var(--red)';
  document.getElementById('crEdge').style.color   = edge > 0 ? 'var(--green)' : 'var(--red)';
}

function prefillCalc() {
  const br = bankrollData.current;
  if (br > 0) document.getElementById('calcBankroll').value = br;
}

function prefillFromPick(i) {
  const o = filtOpps[i];
  if (!o) return;
  prefillCalc();
  document.getElementById('calcProb').value = (o.details.pModel * 100).toFixed(1);
  document.getElementById('calcOdd').value  = o.odd;
  setTimeout(calcStake, 100);
}

// ‚îÄ‚îÄ SIDEBAR STATS ‚îÄ‚îÄ
async function loadSidebar() {
  try {
    const d = await fetch(API + '/api/performance').then(r => r.json());
    const s = d.summary;
    const roi = (s.roi * 100).toFixed(1);
    document.getElementById('sbROI').textContent  = (s.roi >= 0 ? '+' : '') + roi + '%';
    document.getElementById('sbROI').style.color  = s.roi >= 0 ? 'var(--green)' : 'var(--red)';
    document.getElementById('sbHit').textContent  = (s.hitRate * 100).toFixed(1) + '%';
    document.getElementById('sbTotal').textContent= s.totalBets;
  } catch(e) {}

  const br = bankrollData.current || 0;
  const initial = bankrollData.initial || 0;
  document.getElementById('sbBankroll').textContent = br > 0 ? fmt(br) : 'R$ ‚Äî';
  document.getElementById('sbBankrollSub').textContent = initial > 0 ? `inicial: ${fmt(initial)}` : 'n√£o inicializado';
  if (br > 0 && initial > 0) {
    const diff = br - initial;
    const ch   = document.getElementById('sbChange');
    ch.className   = 'sb-br-change ' + (diff >= 0 ? 'pos' : 'neg');
    ch.style.cssText = `display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:100px;font-family:var(--mono);font-size:11px;font-weight:700;background:${diff>=0?'rgba(0,232,122,.1)':'rgba(255,61,90,.1)'};color:${diff>=0?'var(--green)':'var(--red)'};border:1px solid ${diff>=0?'rgba(0,232,122,.2)':'rgba(255,61,90,.2)'}`;
    ch.textContent = (diff >= 0 ? '+' : '') + fmt(diff);
  }
}

// ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ
function getBets()      { return JSON.parse(localStorage.getItem('eggstats_bets') || '[]'); }
function saveBets(bets) { localStorage.setItem('eggstats_bets', JSON.stringify(bets)); }

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
function lgName(c) {
  return { PL:'Premier League', SA:'Serie A', PD:'La Liga', BL1:'Bundesliga', FL1:'Ligue 1', BSA:'Brasileir√£o', DED:'Eredivisie', PPL:'Primeira Liga' }[c] || c;
}

function fmt(v) {
  return new Intl.NumberFormat('pt-BR', { style:'currency', currency:'BRL', minimumFractionDigits:2 }).format(v || 0);
}

function calcKelly(prob, odd, bankroll) {
  const b = odd - 1, q = 1 - prob;
  const kelly = Math.max(0, (prob * b - q) / b);
  return kelly * 0.5 * bankroll; // Half-Kelly
}

function skRows(n) {
  return `<div class="sk-rows">${Array(n).fill(`<div class="sk-row"><div class="sk" style="flex:2"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div></div>`).join('')}</div>`;
}

function showToast(msg) {
  const t = document.createElement('div');
  t.style.cssText = `position:fixed;bottom:24px;right:24px;z-index:9999;padding:12px 20px;background:var(--surf);border:1px solid var(--border);border-radius:8px;font-family:var(--mono);font-size:12px;color:var(--text);box-shadow:0 20px 40px rgba(0,0,0,.5);animation:pageIn .3s ease`;
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 3500);
}
</script>
</body>
</html>
